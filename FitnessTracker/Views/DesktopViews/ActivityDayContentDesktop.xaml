<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:effects="clr-namespace:Syncfusion.Maui.Toolkit.EffectsView;assembly=Syncfusion.Maui.Toolkit"
             xmlns:calendar="clr-namespace:Syncfusion.Maui.Calendar;assembly=Syncfusion.Maui.Calendar"
             xmlns:chart="clr-namespace:Syncfusion.Maui.Toolkit.Charts;assembly=Syncfusion.Maui.Toolkit"
             xmlns:popup="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
             xmlns:converter="clr-namespace:FitnessTracker"
             xmlns:model="clr-namespace:FitnessTracker"
             x:Class="FitnessTracker.ActivityDayContentDesktop">

    <ContentView.Resources>
        <converter:DurationToFormattedStringConverter x:Key="DurationConverter" />
        <converter:ActivityValueConverter x:Key="ActivityConverter" />
        <converter:ActivityIconConverter x:Key="ActivityIconConverter" />
        <converter:StepCalorieIconConverter x:Key="StepCalorieIconConverter" />
        <converter:StepCalorieConverter x:Key="StepCalorieConverter" />
    </ContentView.Resources>

    <ContentView.Content>
        <Grid RowDefinitions="64, *">
            <Grid Grid.Row="0" ColumnDefinitions=".3*, .4*, .3*" Padding="16, 8">
                <calendar:SfCalendar x:Name="calendar" Grid.ColumnSpan="3" SelectedDate="{Binding SelectedDate, Mode=TwoWay}" Mode="Dialog" SelectionMode="Single" View="Month" Background="Transparent" SelectionChanged="Calendar_SelectionChanged" />
                <Border WidthRequest="40" HeightRequest="40" StrokeThickness="0" Grid.Column="0" HorizontalOptions="End">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20" />
                    </Border.StrokeShape>
                    <effects:SfEffectsView>
                        <effects:SfEffectsView.GestureRecognizers>
                            <TapGestureRecognizer Tapped="PreviousIcon_Tapped" />
                        </effects:SfEffectsView.GestureRecognizers>
                        <Label Text="&#xe712;" FontFamily="FitnessTrackerIcon" FontSize="24" HorizontalOptions="Center" VerticalOptions="Center" Style="{StaticResource Icon}" />
                    </effects:SfEffectsView>
                </Border>
                <Border StrokeThickness="0" Grid.Column="1">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="40" />
                    </Border.StrokeShape>
                    <effects:SfEffectsView VerticalOptions="Center">
                        <effects:SfEffectsView.GestureRecognizers>
                            <TapGestureRecognizer Tapped="DayLabel_Tapped" />
                        </effects:SfEffectsView.GestureRecognizers>
                        <VerticalStackLayout Spacing="5">
                            <Label x:Name="dayLabel" Text="{Binding SelectedDate, StringFormat='{0:dddd, d MMMM}'}" FontFamily="Roboto" FontSize="14" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center" Style="{StaticResource Header}" />
                            <HorizontalStackLayout HorizontalOptions="Center">
                                <Label Text="{Binding ., Converter={StaticResource StepCalorieIconConverter}}" FontFamily="FitnessTrackerIcon" FontSize="14" VerticalOptions="Center" TextColor="{Binding ., Converter={StaticResource StepCalorieIconConverter}, ConverterParameter=Color}" />
                                <Label FontFamily="Roboto" FontSize="14" Style="{StaticResource SubHeader}">
                                    <Label.Text>
                                        <MultiBinding Converter="{StaticResource StepCalorieConverter}">
                                            <Binding Path="SelectedActivityType" />
                                            <Binding Path="TotalSteps" />
                                            <Binding Path="TotalCalories" />
                                        </MultiBinding>
                                    </Label.Text>
                                </Label>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </effects:SfEffectsView>
                </Border>
                <Border x:Name="nextIcon" IsEnabled="False" WidthRequest="40" HeightRequest="40" StrokeThickness="0" Grid.Column="2" HorizontalOptions="Start">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20" />
                    </Border.StrokeShape>
                    <effects:SfEffectsView Grid.Column="2">
                        <effects:SfEffectsView.GestureRecognizers>
                            <TapGestureRecognizer Tapped="NextIcon_Tapped" />
                        </effects:SfEffectsView.GestureRecognizers>
                        <Label Text="&#xe713;" FontFamily="FitnessTrackerIcon" FontSize="24" HorizontalOptions="Center" VerticalOptions="Center" Style="{StaticResource Icon}" />
                    </effects:SfEffectsView>
                </Border>
            </Grid>
            <Grid RowDefinitions="Auto, *" Grid.Row="1" Padding="16">
                <VerticalStackLayout Grid.Row="0" Spacing="10">
                    <!-- Chart -->
                    <Grid Padding="32, 0">
                        <chart:SfCartesianChart PaletteBrushes="{Binding ChartColor}" HeightRequest="200">
                            <chart:SfCartesianChart.XAxes>
                                <chart:DateTimeAxis IntervalType="Hours" Interval="2" EdgeLabelsVisibilityMode="AlwaysVisible" Minimum="{Binding MinStartTime}" Maximum="{Binding MaxEndTime}" ShowMajorGridLines="False" LabelStyle="{chart:ChartAxisLabelStyle LabelFormat='h tt'}">
                                    <chart:DateTimeAxis.MajorTickStyle>
                                        <chart:ChartAxisTickStyle TickSize="0" />
                                    </chart:DateTimeAxis.MajorTickStyle>
                                </chart:DateTimeAxis>
                            </chart:SfCartesianChart.XAxes>
                            <chart:SfCartesianChart.YAxes>
                                <chart:NumericalAxis IsVisible="False" />
                            </chart:SfCartesianChart.YAxes>
                            <model:ColumnSeriesExt ItemsSource="{Binding WalkingChartList}" EnableTooltip="True" XBindingPath="StartTime" YBindingPath="{Binding YBindingProperty}" CornerRadius="4, 4, 0, 0" Width="0.4" Spacing="0.5"/>
                        </chart:SfCartesianChart>
                    </Grid>
                    <!-- Divider -->
                    <Border Background="{AppThemeBinding Light={StaticResource borderLight}, Dark={StaticResource borderDark}}" HeightRequest="1" Margin="8, 0, 8, 8" VerticalOptions="Start"/>
                </VerticalStackLayout>
                <!-- CollectionView -->
                <CollectionView Grid.Row="1" ItemsSource="{Binding WalkingList}" SelectionMode="Single" SelectionChanged="ActivityItem_Tapped" VerticalOptions="FillAndExpand">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions=".8*, .2*" ChildAdded="Grid_ChildAdded">
                                <VerticalStackLayout Grid.Column="0" Padding="10" Spacing="5">
                                    <Label>
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="{Binding ., Converter={StaticResource ActivityIconConverter}}" FontFamily="FitnessTrackerIcon" FontSize="14" TextColor="{AppThemeBinding Light={StaticResource icon-colorLight}, Dark={StaticResource icon-colorDark}}" />
                                                <Span Text="{Binding StartTime, StringFormat='{0: hh:mm tt}'}" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource content-text-color-alt2Light}, Dark={StaticResource content-text-color-alt2Dark}}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <Label Text="{Binding Title}" FontFamily="Roboto" FontSize="16" Style="{StaticResource Header}"/>
                                    <HorizontalStackLayout Spacing="5">
                                        <Label Text="{Binding ., Converter={StaticResource DurationConverter}}" FontFamily="Roboto" FontSize="14" Style="{StaticResource SubHeader}" />
                                        <Label Text="{Binding ., Converter={StaticResource StepCalorieIconConverter}}" FontFamily="FitnessTrackerIcon" FontSize="14" VerticalOptions="Center" TextColor="{Binding ., Converter={StaticResource StepCalorieIconConverter}, ConverterParameter=Color}" />
                                        <Label Text="{Binding ., Converter={StaticResource ActivityConverter}}" FontFamily="Roboto" FontSize="14" Style="{StaticResource SubHeader}" />
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                                <Border StyleId="details" Grid.Column="1" StrokeThickness="0" HeightRequest="40" WidthRequest="40" VerticalOptions="Center" HorizontalOptions="Center">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="20" />
                                    </Border.StrokeShape>
                                    <effects:SfEffectsView>
                                        <effects:SfEffectsView.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnDetailsTapped" />
                                        </effects:SfEffectsView.GestureRecognizers>
                                        <Label Text="&#xe732;" FontFamily="MauiSampleFontIcon" FontSize="24" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" />
                                    </effects:SfEffectsView>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                <popup:SfPopup x:Name="detailspopup" Grid.Column="1" ShowOverlayAlways="False" AutoCloseDuration="5000" ShowHeader="False" ShowFooter="False" HeightRequest="136" WidthRequest="158">
                    <popup:SfPopup.PopupStyle>
                        <popup:PopupStyle CornerRadius="10" />
                    </popup:SfPopup.PopupStyle>
                    <popup:SfPopup.ContentTemplate>
                        <DataTemplate>
                            <VerticalStackLayout Spacing="10" Padding="16">
                                <effects:SfEffectsView>
                                    <effects:SfEffectsView.GestureRecognizers>
                                        <TapGestureRecognizer />
                                    </effects:SfEffectsView.GestureRecognizers>
                                    <Label>
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="&#xe752;  " FontFamily="MauiSampleFontIcon" FontSize="18" />
                                                <Span Text="View" FontFamily="Roboto" FontSize="16" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </effects:SfEffectsView>
                                <effects:SfEffectsView>
                                    <effects:SfEffectsView.GestureRecognizers>
                                        <TapGestureRecognizer />
                                    </effects:SfEffectsView.GestureRecognizers>
                                    <Label>
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="&#xe70c;  " FontFamily="FitnessTrackerIcon" FontSize="18" />
                                                <Span Text="Edit" FontFamily="Roboto" FontSize="16" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </effects:SfEffectsView>
                                <effects:SfEffectsView>
                                    <effects:SfEffectsView.GestureRecognizers>
                                        <TapGestureRecognizer />
                                    </effects:SfEffectsView.GestureRecognizers>
                                    <Label>
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="&#xe70b;  " FontFamily="FitnessTrackerIcon" FontSize="18" />
                                                <Span Text="Delete" FontFamily="Roboto" FontSize="16" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </effects:SfEffectsView>
                            </VerticalStackLayout>
                        </DataTemplate>
                    </popup:SfPopup.ContentTemplate>
                </popup:SfPopup>
            </Grid>
        </Grid>
    </ContentView.Content>

</ContentView>